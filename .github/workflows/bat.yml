#name: Dynamic Environment Variables with Dynamic Loop Range
#
#on:
#  workflow_dispatch:
#    inputs:
#      start:
#        description: 'Start of the sequence'
#        required: true
#        default: 0
#      end:
#        description: 'End of the sequence'
#        required: true
#        default: 3
#
#jobs:
#  set-vars:
#    runs-on: ubuntu-latest
#    outputs:
#      var_values: ${{ steps.set-vars.outputs.var_values }}
#    steps:
#      - name: Checkout code
#        uses: actions/checkout@v2
#
#      - name: Set dynamic environment variables in a loop
#        id: set-vars
#        run: |
#          start=${{ github.event.inputs.start }}
#          end=${{ github.event.inputs.end }}
#          output=""
#          for i in $(seq $start $end); do
#            echo "var_$i=$i" >> $GITHUB_ENV
#            output="$output var_$i=$i"
#          done
#          echo "var_values=$output" >> $GITHUB_OUTPUT
#
#  use-vars:
#    runs-on: ubuntu-latest
#    needs: set-vars
#    steps:
#      - name: Checkout code
#        uses: actions/checkout@v2
#
#      - name: Extract and print dynamic environment variables
#        run: |
#          var_values="${{ needs.set-vars.outputs.var_values }}"
#          for var in $var_values; do
#            echo $var >> $GITHUB_ENV
#          done
#          source $GITHUB_ENV
#          for var in $var_values; do
#            var_name=$(echo $var | cut -d '=' -f 1)
#            echo "$var_name=${!var_name}"
#          done

name: Dynamic Array Structure Matrix

on:
  workflow_dispatch:
    inputs:
      start:
        description: 'Start of the sequence'
        required: true
        default: 1
      end:
        description: 'End of the sequence'
        required: true
        default: 2

jobs:
  test:
    strategy:
      matrix:
        tests:
          - config:
            - portalName: cm3
              suiteName: "BookAppointmentBacklogTest=cm3"
            - portalName: cm3
              suiteName: "CM3URLBacklogTest=cm3"
          - setup:
            - portalName: cm3
              suiteName: "CM7BacklogRegistrationDateTest=cm3"
            - portalName: cm3
              suiteName: "CM7CappedPricingGuideGridListView=cm3"

    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Print tests matrix variables
        run: |
          echo "Tests matrix:"
          echo "portalName: ${{ matrix.tests.config.portalName }}"
          echo "suiteName: ${{ matrix.tests.config.suiteName }}"

      - name: Print setup matrix variables
        run: |
          echo "Setup matrix:"
          echo "portalName: ${{ matrix.setup.config.portalName }}"
          echo "suiteName: ${{ matrix.setup.config.suiteName }}"